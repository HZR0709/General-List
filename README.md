# ä»»åŠ¡ç®¡ç†å™¨ (Task Manager)

ä¸€ä¸ªåŸºäºCè¯­è¨€å®ç°çš„è½»é‡çº§ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨é€šç”¨åŒå‘é“¾è¡¨æ•°æ®ç»“æ„å­˜å‚¨å’Œç®¡ç†ä»»åŠ¡ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘æ“ä½œã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… ä»»åŠ¡å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰
- âœ… ä»»åŠ¡çŠ¶æ€ç®¡ç†ï¼ˆå¾…å¤„ç†ã€è¿è¡Œä¸­ã€å·²å®Œæˆã€å·²å–æ¶ˆï¼‰
- âœ… æ‰¹é‡æ“ä½œï¼ˆå¯åŠ¨æ‰€æœ‰å¾…å¤„ç†ä»»åŠ¡ï¼‰
- âœ… æŒ‰æ¡ä»¶ç­›é€‰å’Œæ›´æ–°
- âœ… ä»»åŠ¡ä¼˜å…ˆçº§ç®¡ç†
- âœ… å¤šçº¿ç¨‹å®‰å…¨å¹¶å‘æ“ä½œ

### é«˜çº§ç‰¹æ€§
- ğŸ”’ **çº¿ç¨‹å®‰å…¨**ï¼šæ‰€æœ‰å…¬å…±æ“ä½œå‡ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤
- ğŸš€ **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹æ£€æŸ¥å’Œæšä¸¾çŠ¶æ€
- ğŸ“Š **è¯¦ç»†æ—¥å¿—**ï¼šæ ¼å¼åŒ–è¾“å‡ºä»»åŠ¡ä¿¡æ¯
- ğŸ§ª **å…¨é¢æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œå¹¶å‘æµ‹è¯•
- ğŸ› **å†…å­˜è°ƒè¯•**ï¼šValgrindæ”¯æŒ
- ğŸ”„ **ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹**ï¼šæ¼”ç¤ºå¹¶å‘ä»»åŠ¡å¤„ç†

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ include/                    # å¤´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ list.h                 # é“¾è¡¨æ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ task.h                 # ä»»åŠ¡ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ task_manager.h         # ä»»åŠ¡ç®¡ç†å™¨æ¥å£
â”œâ”€â”€ src/                       # æºæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ list.c                 # é“¾è¡¨å®ç°
â”‚   â”œâ”€â”€ task.c                 # ä»»åŠ¡æ“ä½œå‡½æ•°
â”‚   â””â”€â”€ task_manager.c         # ä»»åŠ¡ç®¡ç†å™¨å®ç°
â”œâ”€â”€ test/                      # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ test_list.c            # é“¾è¡¨å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_task_mgr.c        # ä»»åŠ¡ç®¡ç†å™¨é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_multithread.c     # å¤šçº¿ç¨‹å¹¶å‘æµ‹è¯•
â”œâ”€â”€ main.c                     # ä¸»ç¨‹åºç¤ºä¾‹
â”œâ”€â”€ Makefile                   # æ„å»ºé…ç½®
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- GCCç¼–è¯‘å™¨ï¼ˆæ”¯æŒC11ï¼‰
- Linux/macOSç¯å¢ƒ
- Makeæ„å»ºå·¥å…·
- Valgrindï¼ˆå¯é€‰ï¼Œç”¨äºå†…å­˜æ£€æŸ¥ï¼‰
- pthreadåº“ï¼ˆå·²åŒ…å«åœ¨æ ‡å‡†åº“ä¸­ï¼‰

### ç¼–è¯‘é¡¹ç›®

```bash
# ç¼–è¯‘ä¸»ç¨‹åº
make

# ç¼–è¯‘æ‰€æœ‰æµ‹è¯•
make test

# ç¼–è¯‘å¤šçº¿ç¨‹æµ‹è¯•
make test-multithread

# ç¼–è¯‘å¹¶è¿è¡Œä¸»ç¨‹åº
make && ./task_manager
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œé“¾è¡¨æµ‹è¯•
make test-list && ./test_list

# è¿è¡Œä»»åŠ¡ç®¡ç†å™¨æµ‹è¯•
make test-task-mgr && ./test_task_mgr

# è¿è¡Œå¤šçº¿ç¨‹å¹¶å‘æµ‹è¯•
make test-multithread && ./test_multithread

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test
./test_list
./test_task_mgr
./test_multithread
```

## å¤šçº¿ç¨‹å¹¶å‘æµ‹è¯•

é¡¹ç›®åŒ…å«ä¸€ä¸ªå®Œæ•´çš„å¤šçº¿ç¨‹å¹¶å‘æµ‹è¯• (`test_multithread.c`)ï¼Œæ¼”ç¤ºäº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š

### æµ‹è¯•åœºæ™¯
1. **ç”Ÿäº§è€…çº¿ç¨‹**ï¼ˆ4ä¸ªï¼‰ï¼šå¹¶å‘æ·»åŠ æ–°ä»»åŠ¡
2. **å·¥ä½œçº¿ç¨‹**ï¼ˆ2ä¸ªï¼‰ï¼šå¹¶å‘å¯åŠ¨å¾…å¤„ç†ä»»åŠ¡
3. **ç›‘æ§çº¿ç¨‹**ï¼ˆ1ä¸ªï¼‰ï¼šå®æ—¶æ‰“å°ç³»ç»ŸçŠ¶æ€å¿«ç…§

### è¿è¡Œå¹¶å‘æµ‹è¯•
```bash
# ç¼–è¯‘å¹¶å‘æµ‹è¯•
make test-multithread

# è¿è¡Œå¹¶å‘æµ‹è¯•ï¼ˆé»˜è®¤è¿è¡Œ5ç§’ï¼‰
./test_multithread

# è‡ªå®šä¹‰è¿è¡Œæ—¶é—´
./test_multithread 10  # è¿è¡Œ10ç§’
```

### å¹¶å‘æµ‹è¯•ä»£ç ç¤ºä¾‹
```c
#include <pthread.h>
#include "task_manager.h"

#define PRODUCER_THREADS 4
#define WORKER_THREADS   2

static TaskManager* g_mgr;
static volatile int g_running = 1;

// ç”Ÿäº§è€…çº¿ç¨‹ï¼šå¹¶å‘æ·»åŠ ä»»åŠ¡
void* producer_thread(void* arg) {
    while (g_running) {
        task_manager_add(g_mgr, "concurrent-task", rand() % 10);
        usleep(1000);
    }
    return NULL;
}

// å·¥ä½œçº¿ç¨‹ï¼šå¹¶å‘æ›´æ–°ä»»åŠ¡çŠ¶æ€
void* worker_thread(void* arg) {
    while (g_running) {
        task_manager_start_all_pending(g_mgr);
        usleep(2000);
    }
    return NULL;
}

// ç›‘æ§çº¿ç¨‹ï¼šå®‰å…¨è¯»å–ä»»åŠ¡çŠ¶æ€
void* monitor_thread(void* arg) {
    while (g_running) {
        task_manager_print(g_mgr);  // çº¿ç¨‹å®‰å…¨
        usleep(500000);
    }
    return NULL;
}
```

## APIä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```c
#include "task_manager.h"

int main() {
    // åˆ›å»ºä»»åŠ¡ç®¡ç†å™¨ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    TaskManager* mgr = task_manager_create();
    
    // æ·»åŠ ä»»åŠ¡
    task_manager_add(mgr, "ç¼–å†™æ–‡æ¡£", 3);
    task_manager_add(mgr, "ä¿®å¤bug", 1);
    task_manager_add(mgr, "ä»£ç å®¡æŸ¥", 2);
    
    // å¯åŠ¨æ‰€æœ‰å¾…å¤„ç†ä»»åŠ¡
    task_manager_start_all_pending(mgr);
    
    // æ›´æ–°ä»»åŠ¡çŠ¶æ€
    task_manager_set_status(mgr, 0, TASK_DONE);
    
    // åˆ é™¤ä»»åŠ¡
    task_manager_remove(mgr, 1);
    
    // æ‰“å°æ‰€æœ‰ä»»åŠ¡ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    task_manager_print(mgr);
    
    // æ¸…ç†èµ„æº
    task_manager_destroy(mgr);
    
    return 0;
}
```

### å¤šçº¿ç¨‹ç¯å¢ƒä½¿ç”¨

```c
#include <pthread.h>
#include "task_manager.h"

TaskManager* shared_mgr;

void* thread_func(void* arg) {
    // çº¿ç¨‹å®‰å…¨çš„æ“ä½œ
    for (int i = 0; i < 100; i++) {
        char name[64];
        snprintf(name, sizeof(name), "task-%d", i);
        
        // è¿™äº›æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„
        task_manager_add(shared_mgr, name, i % 5);
        
        if (i % 10 == 0) {
            task_manager_start_all_pending(shared_mgr);
        }
    }
    return NULL;
}
```

## å†…å­˜ç®¡ç†

é¡¹ç›®åŒ…å«å®Œæ•´çš„å†…å­˜æ£€æŸ¥æ”¯æŒï¼š

```bash
# æ£€æŸ¥ä¸»ç¨‹åºå†…å­˜æ³„æ¼
make memcheck

# æ£€æŸ¥é“¾è¡¨æµ‹è¯•å†…å­˜
make test-list-memcheck

# æ£€æŸ¥ä»»åŠ¡ç®¡ç†å™¨æµ‹è¯•å†…å­˜
make test-task-mgr-memcheck

# æ£€æŸ¥å¤šçº¿ç¨‹æµ‹è¯•å†…å­˜
make test-multithread-memcheck

# å¿«é€Ÿå†…å­˜æ£€æŸ¥
make quick-check
```

## æ„å»ºé€‰é¡¹

```bash
# è°ƒè¯•ç‰ˆæœ¬ï¼ˆå¸¦DEBUGç¬¦å·ï¼‰
make debug

# å‘å¸ƒç‰ˆæœ¬ï¼ˆä¼˜åŒ–ï¼‰
make release

# çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
make threadsafe

# æ¸…ç†æ„å»ºæ–‡ä»¶
make clean

# é‡æ–°æ„å»º
make rebuild

# ç¼–è¯‘å¤šçº¿ç¨‹æµ‹è¯•
make test-multithread

# ç¼–è¯‘æ‰€æœ‰ç›®æ ‡
make all
```

## å¹¶å‘è®¾è®¡

### çº¿ç¨‹å®‰å…¨ä¿è¯
1. **äº’æ–¥é”ä¿æŠ¤**ï¼šæ‰€æœ‰å…¬å¼€APIéƒ½ä½¿ç”¨pthreadäº’æ–¥é”ä¿æŠ¤
2. **ç»†ç²’åº¦é”**ï¼šæ¯ä¸ªæ“ä½œä»…åœ¨å¿…è¦æ—¶æŒæœ‰é”ï¼Œå‡å°‘é”ç«äº‰
3. **æ­»é”é¿å…**ï¼šé”çš„è·å–å’Œé‡Šæ”¾ä¸¥æ ¼éµå®ˆé¡ºåº
4. **æ¡ä»¶å˜é‡**ï¼šæ”¯æŒæœªæ¥æ‰©å±•çš„çº¿ç¨‹åŒæ­¥

### å¹¶å‘æ¨¡å¼
1. **è¯»è€…-å†™è€…æ¨¡å¼**ï¼šæ”¯æŒå¤šä¸ªè¯»è€…å¹¶å‘è®¿é—®
2. **ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼**ï¼šæ¼”ç¤ºä»£ç å±•ç¤ºæ­¤æ¨¡å¼
3. **å·¥ä½œçº¿ç¨‹æ± **ï¼šå¯æ‰©å±•ä¸ºçº¿ç¨‹æ± å¤„ç†ä»»åŠ¡

## æµ‹è¯•è¦†ç›–ç‡

æµ‹è¯•å¥—ä»¶è¦†ç›–ä»¥ä¸‹åŠŸèƒ½ï¼š
1. âœ… é“¾è¡¨åŸºæœ¬æ“ä½œï¼ˆæ’å…¥ã€åˆ é™¤ã€éå†ï¼‰
2. âœ… ä»»åŠ¡ç®¡ç†å™¨ç”Ÿå‘½å‘¨æœŸ
3. âœ… ä»»åŠ¡çŠ¶æ€è½¬æ¢
4. âœ… è¾¹ç•Œæ¡ä»¶å¤„ç†
5. âœ… å†…å­˜ç®¡ç†æ­£ç¡®æ€§
6. âœ… **å¤šçº¿ç¨‹å¹¶å‘æ“ä½œ**ï¼ˆæ–°å¢ï¼‰
7. âœ… **çº¿ç¨‹å®‰å…¨æ€§éªŒè¯**ï¼ˆæ–°å¢ï¼‰

## æ€§èƒ½ç‰¹ç‚¹

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - æ’å…¥ï¼šO(1)ï¼ˆå°¾éƒ¨æ’å…¥ï¼‰
  - åˆ é™¤ï¼šO(n)ï¼ˆéœ€è¦éå†æŸ¥æ‰¾ï¼‰
  - æŸ¥æ‰¾ï¼šO(n)
  - æ›´æ–°ï¼šO(n)

- **ç©ºé—´å¤æ‚åº¦**ï¼š
  - æ¯ä¸ªä»»åŠ¡ï¼š~80å­—èŠ‚
  - é“¾è¡¨èŠ‚ç‚¹å¼€é”€ï¼š~16å­—èŠ‚ï¼ˆå–å†³äºç³»ç»Ÿï¼‰

- **å¹¶å‘æ€§èƒ½**ï¼š
  - è¯»æ“ä½œï¼šå¯å¹¶å‘è¿›è¡Œ
  - å†™æ“ä½œï¼šä¸²è¡ŒåŒ–ï¼Œä½†é”æŒæœ‰æ—¶é—´çŸ­
  - é€‚åˆä¸­ç­‰å¹¶å‘åœºæ™¯ï¼ˆæ•°åä¸ªçº¿ç¨‹ï¼‰

## æ•…éšœæ’é™¤

### å¤šçº¿ç¨‹å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯ï¼šæœªå®šä¹‰çš„pthreadå‡½æ•°**
   ```bash
   # ç¡®ä¿é“¾æ¥pthreadåº“
   gcc -pthread your_program.c -o your_program
   ```

2. **æ­»é”æ£€æµ‹**
   ```bash
   # ä½¿ç”¨Helgrindæ£€æµ‹æ­»é”
   valgrind --tool=helgrind ./test_multithread
   ```

3. **ç«äº‰æ¡ä»¶æ£€æµ‹**
   ```bash
   # ä½¿ç”¨DRDæ£€æµ‹çº¿ç¨‹é”™è¯¯
   valgrind --tool=drd ./test_multithread
   ```

### è°ƒè¯•æç¤º

```bash
# ä½¿ç”¨GDBè°ƒè¯•å¤šçº¿ç¨‹ç¨‹åº
gdb -ex "set non-stop on" -ex "run" ./test_multithread

# æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€
(gdb) info threads
(gdb) thread apply all bt

# è®¾ç½®çº¿ç¨‹ç‰¹å®šæ–­ç‚¹
(gdb) break producer_thread
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦æƒ…è§LICENSEæ–‡ä»¶ã€‚

## è´¡çŒ®æŒ‡å—

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## æœªæ¥æ‰©å±•

è®¡åˆ’ä¸­çš„åŠŸèƒ½ï¼š
- [ ] ä»»åŠ¡æŒä¹…åŒ–ï¼ˆæ–‡ä»¶/æ•°æ®åº“ï¼‰
- [ ] ä»»åŠ¡ä¾èµ–å…³ç³»
- [ ] ä»»åŠ¡è°ƒåº¦å™¨
- [ ] çº¿ç¨‹æ± æ”¯æŒ
- [ ] æ¡ä»¶å˜é‡é€šçŸ¥æœºåˆ¶
- [ ] è¯»å†™é”ä¼˜åŒ–ï¼ˆæé«˜è¯»å¹¶å‘æ€§ï¼‰
- [ ] ç½‘ç»œæ¥å£
- [ ] GUIç•Œé¢

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä¸»è¦ç”¨äºæ•™å­¦å’Œæ¼”ç¤ºç›®çš„ï¼Œå±•ç¤ºäº†Cè¯­è¨€ä¸­å¤šçº¿ç¨‹ç¼–ç¨‹ã€æ•°æ®ç»“æ„ã€å†…å­˜ç®¡ç†å’Œè½¯ä»¶å·¥ç¨‹çš„æœ€ä½³å®è·µã€‚å¤šçº¿ç¨‹æµ‹è¯•æ¨¡å—ç‰¹åˆ«é€‚åˆå­¦ä¹ å¹¶å‘ç¼–ç¨‹å’Œçº¿ç¨‹å®‰å…¨è®¾è®¡ã€‚